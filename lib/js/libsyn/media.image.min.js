var libsynSelectImage;
( function($) {
	libsynSelectImage = function ( event, props ) {
		var b;
		if (!event) event = window.event;
		event.preventDefault();
		if (b) {
			b.open();
			return
		}
		b = wp.media.frames.libsyn_media_frame = wp.media({
				className: "media-frame libsyn-image-frame",
				frame: "select",
				multiple: false,
				title: libsyn_nmp_image.title,
				library: {
					type: "image"
				},
				button: {
					text: libsyn_nmp_image.button
				}
			});
		b.on("select", function () {
			var d = b.state().get("selection").first().toJSON();
			if ( !! d.url ) {
				if ( !!props ) {
					props.setAttributes( { libsynNewMediaImage: d.url } );
				}
				$("#libsyn-new-media-image").val(d.url).attr("readonly", true);
				libsyn_nmp_data.libsyn_new_media_image = d.url;
				$.get(libsyn_nmp_ftp.admin_ajax_url + "?action=update_libsyn_postmeta&update_libsyn_postmeta=1&post_id=" + libsyn_nmp_ftp.post_id + "&meta_key=libsyn-new-media-image&meta_value=" + d.url);
			}
		});
		b.open()
	}
}) (jQuery);
