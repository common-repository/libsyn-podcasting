var libsynSelectMedia;
( function($) {
	var b;
	libsynSelectMedia = function ( event, props ) {
		if (!event) event = window.event;
		event.preventDefault();
		if (b) {
			b.open();
			return
		}
		b = wp.media.frames.libsyn_media_frame = wp.media({
				className: "media-frame libsyn-media-frame",
				frame: "select",
				multiple: false,
				title: libsyn_nmp_media.title,
				library: {
					type: ['video/avi', 'video/divx', 'video/x-flv', 'video/quicktime', 'video/mpeg', 'video/mp4', 'video/ogg', 'video/webm', 'video/x-matroska', 'audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/midi', 'audio/x-ms-wma', 'audio/x-ms-wa', 'audio/x-matroska']
				},
				button: {
					text: libsyn_nmp_media.button
				}
			});
		b.on("select", function () {
			$('#libsyn-new-media-media').clone().attr('type', 'text').insertAfter('#libsyn-new-media-media').prev().remove();
			var d = b.state().get("selection").first().toJSON();
			if ( !! d.url ) {
				if ( !!props ) {
					props.setAttributes( { libsynNewMediaMedia: d.url } );
				}
				$("#libsyn-new-media-image").val(d.url).attr("readonly", true);
				libsyn_nmp_data.libsyn_new_media_image = d.url;
				$.get(libsyn_nmp_ftp.admin_ajax_url + "?action=update_libsyn_postmeta&update_libsyn_postmeta=1&post_id=" + libsyn_nmp_ftp.post_id + "&meta_key=libsyn-new-media-image&meta_value=" + d.url);
			}
			$("#libsyn-new-media-media").val(d.url).attr("readonly", true);
			libsyn_nmp_data.libsyn_new_media_media = d.url;
			$.get(libsyn_nmp_ftp.admin_ajax_url + "?action=update_libsyn_postmeta&update_libsyn_postmeta=1&post_id=" + libsyn_nmp_ftp.post_id + "&meta_key=libsyn-new-media-media&meta_value=" + d.url);
		});
		b.open()
	}
}) (jQuery);
